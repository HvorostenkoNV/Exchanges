@startuml

namespace Main.Exchange.Procedures #BBB {
    class Manager {
        +{static}getProcedures(Main.Data.Map $filter = null) : Data.ProceduresSet
    }

    interface Procedure {
        +getCode() : string
        +getParticipants() : Data.ParticipantsSet
        +getFields() : Fields.FieldsSet
        +getDataMatchingRules() : Rules.DataMatchingRules
        +getDataCombiningRules() : Rules.DataCombiningRules
    }

    abstract AbstractProcedure {
        +getCode() : string
        +getParticipants() : Data.ParticipantsSet
        +getFields() : Fields.FieldsSet
        +getDataMatchingRules() : Rules.DataMatchingRules
        +getDataCombiningRules() : Rules.DataCombiningRules
    }

    class UsersExchange {

    }
    /' ------------------------------------------- '/
    /' ----------------- Fields ------------------ '/
    /' ------------------------------------------- '/
    namespace Fields #FFF {
        class Field {
            +__construct(Procedure $procedure, Main.Data.Map $params, Participants.Fields.Field[] $participantFields)
            +getProcedure() : Procedure
            +getParam(string $param) : mixed
            +getParticipantsFields() : Participants.Fields.Field[]
        }

        class FieldsSet < extends Main.Data.SetData > {
            +current() : ?Field
            +delete(Field $object) : void
            +push(Field $object) :void
        }

        FieldsSet o-- Field
    }
    /' ------------------------------------------- '/
    /' ------------------ Rules ------------------ '/
    /' ------------------------------------------- '/
    namespace Rules #FFF {
        class DataMatchingRules < extends Main.Data.MapData > {
            +set(Data.ParticipantsSet $key, Fields.FieldsSet $value) : void
            +get(Data.ParticipantsSet $key) : Fields.FieldsSet
        }

        class DataCombiningRules < extends Main.Data.MapData > {
            +set(Participants.Fields.Field $key, int $value) : void
            +get(Participants.Fields.Field $key) : int
        }
    }
    /' ------------------------------------------- '/
    /' ------------------ Data ------------------- '/
    /' ------------------------------------------- '/
    namespace Data #FFF {
        class ParticipantsSet < extends Main.Data.SetData > {
            +current() : ?Participants.Participant
            +delete(Participants.Participant $object) : void
            +push(Participants.Participant $object) :void
        }

        class ProceduresSet < extends Main.Data.SetData > {
            +current() : ?Procedures.Procedure
            +delete(Procedures.Procedure $object) : void
            +push(Procedures.Procedure $object) :void
        }
    }
    /' ------------------------------------------- '/
    /' ---------------- Relations ---------------- '/
    /' ------------------------------------------- '/
    Manager             -       Procedure
    Procedure           <|--    AbstractProcedure
    AbstractProcedure   <|--    UsersExchange

    Manager     o-- Main.Exchange.Procedures.Data.ProceduresSet
    Procedure   o-- Main.Exchange.Procedures.Data.ParticipantsSet
    Procedure   o-- Main.Exchange.Procedures.Fields.FieldsSet
    Procedure   o-- Main.Exchange.Procedures.Rules.DataMatchingRules
    Procedure   o-- Main.Exchange.Procedures.Rules.DataCombiningRules
}

@enduml